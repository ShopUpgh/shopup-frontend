<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Login - ShopUp</title>

  <link rel="icon" href="../favicon.ico"/>

  <link rel="stylesheet" href="../css/styles.css"/>
  <link rel="stylesheet" href="../css/login-styles.css"/>

  <!-- ‚úÖ Sentry -->
  <script src="https://js-de.sentry-cdn.com/c4c92ac8539373f9c497ba50f31a9900.min.js" crossorigin="anonymous"></script>
  <script src="/js/sentry-config.js"></script>

  <!-- ‚úÖ Supabase (single source of truth) -->
  <script type="module" src="/js/supabase-init.js"></script>

  <style>
    .auth-wrap { min-height:100vh; display:grid; place-items:center; padding:24px; background:var(--gray-50); }
    .auth-card { width:100%; max-width:420px; background:var(--bg-white); border:1px solid var(--border-color);
      border-radius:16px; box-shadow:var(--shadow-lg); padding:26px; }
    .auth-brand { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .auth-brand .mark { width:44px; height:44px; border-radius:12px; display:grid; place-items:center;
      background:linear-gradient(135deg,var(--primary-light),var(--primary-color)); color:white; font-weight:900; }
    .auth-brand .name { font-weight:900; font-size:1.2rem; color:var(--text-dark); }
    .auth-title { margin-top:12px; margin-bottom:6px; font-size:1.6rem; }
    .auth-subtitle { color:var(--text-light); margin-bottom:16px; }
    label { display:block; margin:12px 0 6px; font-weight:800; color:var(--text-dark); }
    input { width:100%; padding:12px; border:1px solid var(--border-color); border-radius:12px; background:white; }
    input:focus { border-color:#bfdbfe; box-shadow:0 0 0 4px rgba(37,99,235,.12); }
    .btn-main { width:100%; padding:12px 14px; border:0; border-radius:12px;
      background:var(--primary-color); color:white; font-weight:900; margin-top:14px; cursor:pointer; }
    .btn-main[disabled] { opacity:.65; cursor:not-allowed; }
    .meta-row { display:flex; justify-content:space-between; gap:10px; margin-top:14px;
      font-size:.95rem; color:var(--text-light); }
    .msg { margin-top:12px; padding:10px 12px; border-radius:12px; display:none; font-weight:800; }
    .msg.err { background:#fee2e2; color:#991b1b; }
    .msg.ok  { background:#dcfce7; color:#166534; }
  </style>
</head>

<body>
  <div class="auth-wrap">
    <div class="auth-card">

      <div class="auth-brand">
        <div class="mark">üõçÔ∏è</div>
        <div class="name">ShopUp</div>
      </div>

      <h1 class="auth-title">Customer Login</h1>
      <p class="auth-subtitle">Welcome back. Sign in to continue shopping.</p>

      <div id="msg" class="msg"></div>

      <form id="customerLoginForm" autocomplete="on">
        <label>Email</label>
        <input id="email" type="email" required />

        <label>Password</label>
        <input id="password" type="password" required />

        <button class="btn-main" id="btn" type="submit">Login</button>

        <div class="meta-row">
          <span>New here?</span>
          <a href="customer-register.html">Create account</a>
        </div>
      </form>

      <div class="small" style="margin-top:14px;">
        <a href="../index.html">‚Üê Back to Home</a>
      </div>

    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById("customerLoginForm");
      const msg = document.getElementById("msg");
      const btn = document.getElementById("btn");

      function show(type, text) {
        msg.className = "msg " + (type === "error" ? "err" : "ok");
        msg.textContent = text;
        msg.style.display = "block";
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        msg.style.display = "none";
        btn.disabled = true;

        try {
          const client = await window.supabaseReady;
          if (!client) throw new Error("Supabase not initialized");

          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value;

          const { data, error } = await client.auth.signInWithPassword({ email, password });
          if (error) throw error;

          // Store (optional) for other pages that still read these
          localStorage.setItem("authToken", data.session.access_token);
          localStorage.setItem("currentUser", JSON.stringify(data.user));
          localStorage.setItem("role", "customer");

          if (window.Sentry) {
            window.Sentry.setUser({ id: data.user.id, email: data.user.email, role: "customer" });
            window.Sentry.addBreadcrumb({ category: "auth", message: "Customer login success", level: "info" });
          }

          show("ok", "Login successful. Redirecting‚Ä¶");
          setTimeout(() => (window.location.href = "customer-dashboard.html"), 800);
        } catch (err) {
          if (window.Sentry) window.Sentry.captureException(err, { tags: { error_category: "login" } });
          show("error", err?.message || "Login failed");
          btn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
