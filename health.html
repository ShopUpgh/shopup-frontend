<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Check - ShopUp</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .health-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status-ok { color: #2d8a3e; }
        .status-error { color: #dc3545; }
        h1 { color: #333; margin-bottom: 20px; }
        .check-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .check-item:last-child { border-bottom: none; }
        .timestamp { color: #666; font-size: 12px; margin-top: 20px; }
        pre {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="health-card">
        <h1>üè• ShopUp Health Check</h1>
        
        <div id="checks">
            <div class="check-item">
                <span>Frontend Status</span>
                <span class="status-ok">‚úÖ OK</span>
            </div>
            <div class="check-item">
                <span>JavaScript Loaded</span>
                <span id="jsStatus">‚è≥ Checking...</span>
            </div>
            <div class="check-item">
                <span>Security Utils</span>
                <span id="securityStatus">‚è≥ Checking...</span>
            </div>
            <div class="check-item">
                <span>Supabase Client</span>
                <span id="supabaseStatus">‚è≥ Checking...</span>
            </div>
            <div class="check-item">
                <span>Database Connection</span>
                <span id="dbStatus">‚è≥ Checking...</span>
            </div>
            <div class="check-item">
                <span>Paystack Config</span>
                <span id="paystackStatus">‚è≥ Checking...</span>
            </div>
        </div>
        
        <p class="timestamp">Checked at: <span id="timestamp"></span></p>
        
        <h3 style="margin-top: 30px;">API Response (JSON)</h3>
        <pre id="jsonOutput">Loading...</pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/security-utils.js"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/paystack-config.js"></script>
    <script>
        const healthData = {
            status: 'ok',
            timestamp: new Date().toISOString(),
            version: '1.0.0',
            checks: {}
        };

        // Update timestamp
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        // Check JavaScript
        document.getElementById('jsStatus').innerHTML = '<span class="status-ok">‚úÖ OK</span>';
        healthData.checks.javascript = 'ok';

        // Check Security Utils
        if (typeof sanitizeHTML === 'function' && typeof RateLimiter !== 'undefined') {
            document.getElementById('securityStatus').innerHTML = '<span class="status-ok">‚úÖ Loaded</span>';
            healthData.checks.securityUtils = 'ok';
        } else {
            document.getElementById('securityStatus').innerHTML = '<span class="status-error">‚ùå Not Loaded</span>';
            healthData.checks.securityUtils = 'error';
            healthData.status = 'degraded';
        }

        // Check Supabase
        setTimeout(async () => {
            if (typeof window.supabase !== 'undefined') {
                document.getElementById('supabaseStatus').innerHTML = '<span class="status-ok">‚úÖ Connected</span>';
                healthData.checks.supabase = 'ok';
                
                // Test database connection
                try {
                    const { data, error } = await window.supabase
                        .from('sellers')
                        .select('count')
                        .limit(1);
                    
                    if (!error) {
                        document.getElementById('dbStatus').innerHTML = '<span class="status-ok">‚úÖ Connected</span>';
                        healthData.checks.database = 'ok';
                    } else {
                        document.getElementById('dbStatus').innerHTML = '<span class="status-error">‚ùå Error: ' + error.message + '</span>';
                        healthData.checks.database = 'error';
                        healthData.status = 'degraded';
                    }
                } catch (e) {
                    document.getElementById('dbStatus').innerHTML = '<span class="status-error">‚ùå Failed</span>';
                    healthData.checks.database = 'error';
                    healthData.status = 'degraded';
                }
            } else {
                document.getElementById('supabaseStatus').innerHTML = '<span class="status-error">‚ùå Not Loaded</span>';
                document.getElementById('dbStatus').innerHTML = '<span class="status-error">‚ùå N/A</span>';
                healthData.checks.supabase = 'error';
                healthData.checks.database = 'error';
                healthData.status = 'error';
            }
            
            // Update JSON output
            document.getElementById('jsonOutput').textContent = JSON.stringify(healthData, null, 2);
        }, 1000);

        // Check Paystack
        setTimeout(() => {
            if (typeof PAYSTACK_CONFIG !== 'undefined') {
                if (PAYSTACK_CONFIG.isConfigured) {
                    document.getElementById('paystackStatus').innerHTML = '<span class="status-ok">‚úÖ Configured</span>';
                    healthData.checks.paystack = 'ok';
                } else {
                    document.getElementById('paystackStatus').innerHTML = '<span class="status-error">‚ö†Ô∏è Placeholder Key</span>';
                    healthData.checks.paystack = 'warning';
                    healthData.status = 'degraded';
                }
            } else {
                document.getElementById('paystackStatus').innerHTML = '<span class="status-error">‚ùå Not Loaded</span>';
                healthData.checks.paystack = 'error';
            }
        }, 500);
    </script>
</body>
</html>
